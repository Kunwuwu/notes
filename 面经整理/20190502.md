# [阿里中间件C++，LIANG](https://www.nowcoder.com/discuss/182300 )

## 一面

### 1. 几百G的日志文件，存放访问过的IP地址，找访问量topk，如何快速查找某个ip是否访问过（是否包含某个ip） ？

**第一问解法：**

这个应该不算简单的TopK问题了，参考解法[海量日志数据，提取出某日访问百度次数最多的那个IP ](https://github.com/yoghurtjia/-python-BAT-/blob/master/most_common_ip.py )。

1. 对于海量数据中的每一个ip，通过`hash()`函数计算`hash(ip) % 1000` ，存到1000个文件中，这样做的目的是让相同的ip都存到同一个文件中；
2. 可以得到每个文件的平均大小都会小于1G，这样就能加载到内存中；
3. 分别对于每个小文件，建立一个ip为key，访问次数为value的map，通过最小堆查找topK的思路，找出每个文件中访问量topK的ip，并记录下每个ip的访问量，这里可以建立结构体数组来实现；
4. 再将所有文件的前十的ip合并，再利用最小堆查找TopK的思路，找出topK。

解法仍然存在一个问题，就是如果单个ip的访问量很大，就会造成单个文件的大小太大。

**第二问解法：**

ip地址总共的数目其实也就2^32个，可以用512M的内存，一个bit位代表一个unsigned int值。在第一问的基础上读入文件中的ip，设置相应的bit位。然后读入查询的ip，查看相应的位是不是1，是1则表示访问过，否则0没访问过。